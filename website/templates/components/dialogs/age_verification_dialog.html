<!doctype html>
<html>
<!--
  Age verification and cookie notification
  Created: 7/3/2023
  Updated: 7/29/2024
-->
<!-- Age Verification Dialog -->
<div class="modal" id="age-verification" tabindex="-1" style="display: none;">
  <div class="modal-dialog modal-fullscreen">
    <div class="modal-content">
      <div class="modal-body markdown d-flex justify-content-center align-items-center text-center" style="height: 100vh;">
        <div class="d-flex flex-column" style="max-width:420px;">
          <!-- Title -->
          <div class="d-flex text-start mb-3">
            <img src="https://firebasestorage.googleapis.com/v0/b/cannlytics.appspot.com/o/assets%2Fimages%2Fplaceholders%2Fage-verification-symbol.png?alt=media&token=95abaeee-705e-44e9-841b-e32ac36dd7fe" 
                 alt="Age Verification" 
                 style="height:64px;" 
                 class="me-2">
            <h5 class="h2 mb-0">Are you 21 or older?</h5>
          </div>

          <!-- Birthdate input -->
          <p class="text-start mt-2 mb-2">Confirm your birthdate here:</p>
          <div>
            <input
              id="birthdate"
              type="date"
              class="form-control mb-3 serif"
            >
          </div>

          <!-- Message -->
          <p class="text-start mt-0">
            By accessing Cannlytics, you accept our
            <a href="https://docs.cannlytics.com/terms">terms of use</a>
            and acknowledge that you have read our
            <a href="https://docs.cannlytics.com/privacy">privacy policy</a>.
          </p>

          <!-- Actions -->
          <div class="d-flex justify-content-end mt-3">
            <button
              type="button"
              class="btn btn-sm-light btn-md-light text-dark serif me-2"
              onclick="cannlytics.website.rejectAgeCheck();"
            >
              No, not today
            </button>
            <button
              id="accept-age-verification-button"
              type="button"
              class="btn btn-sm bg-gradient-green text-white serif"
              onclick="cannlytics.website.acceptAgeCheck();"
              disabled
            >
              Yes, I'm 21+
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Function to check if user has accepted age verification
  function ageCheck() {
    const acceptAge = localStorage.getItem('cannlytics_age');
    console.log('acceptAge', acceptAge);
    if (!acceptAge) {
      const modal = document.getElementById('age-verification');
      modal.style.display = 'block';
      const birthdateInput = document.getElementById('birthdate');
      birthdateInput.addEventListener('change', (event) => {
        console.log('event.target.value', event.target.value);
        if (cannlytics.website.verifyAge(event.target.value)) {
          document.getElementById('accept-age-verification-button').disabled = false;
          console.log('age verified');
        } else {
          document.getElementById('accept-age-verification-button').disabled = true;
          console.log('age not verified');
        }
      });
    }
  }

  // Add sign-in on enter on login password field.
  document.getElementById('sign-in-password').addEventListener('keyup', function(event) {
    event.preventDefault();
    if (event.keyCode === 13) cannlytics.auth.signIn(event);
  });

  // Initialize age check
  document.addEventListener('DOMContentLoaded', ageCheck);
</script>
</html>